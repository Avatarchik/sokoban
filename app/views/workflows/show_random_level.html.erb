<%= javascript_include_tag "workflows" %>

<div id="random-level">
  <div class="title">
    Can you solve this level?
  </div>

  <div class="random-level tips" title="Try this level" data-id           = "<%= @level.id %>"
                                                        data-level-grid   = "<%= @level.inline_grid_with_floor %>"
                                                        data-level-width  = "<%= @level.width %>"
                                                        data-level-height = "<%= @level.height %>"
                                                        data-level-name   = "<%= u(@level.name) %>"
                                                        data-pack-name    = "<%= u(@level.pack.name) %>">
    <div id="random-level-canvas">
    </div>
  </div>

  <div id="completed-friends">
    <div id="completed-friends-in">
      <% friend_names = @level.friends_scores_names(current_user).shuffle if current_user %>
      <% all_names    = @level.all_scores_names.shuffle %>

      <% if not current_user or friend_names.count == 0 %>
        <% if all_names.count == 0 %>
          This level has not yet been solved.
        <% elsif all_names.count == 1 %>
          This level has been solved by <span class="tips" title="<%= all_names.to_sentence(:last_word_connector => ' and ') %>">one person</span>.
        <% else %>
          This level has been solved by <span class="tips" title="<%= all_names.to_sentence(:last_word_connector => ' and ') %>"><%= all_names.count %> people</span>.
        <% end %>
      <% else %>
        <% if friend_names.count <= 5 %>
          This level has been solved by <%= friend_names.to_sentence(:last_word_connector => ' and ') %>.
        <% else %>
          This level has been solved by <%= friend_names.take(5).join(', ') %> and <span class="tips" title="<%= friend_names.drop(5).to_sentence(:last_word_connector => ' and ') %>"><%= friend_names.count - 5 %> other friends</span>.
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="challenge-buttons">
    <div class="reload-button">
      <a href="#">Another Challenge</a>
    </div>

    <div class="later-button">
      <a href="#">Later</a>
    </div>
  </div>
</div>
